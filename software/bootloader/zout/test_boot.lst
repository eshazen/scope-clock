   1:					;;
   2:					;; test EEPROM copy
   3:					;; 
   4:				
   5:     -	F000          		org	$f000
   6:				
   7:				;;; EEPROM loader
   8:				;;; load all images from the flash table
   9:    0+16	F000  2A02F1  		ld	hl,(flashtable)
  10:   16+4	F003  7C      		ld	a,h		;check for 0xcafe
  11:   20+7	F004  FECA    		cp	0xca
  12:   27+10	F006  C20081  		jp	nz,$8100
  13:   37+4	F009  7D      		ld	a,l
  14:   41+7	F00A  FEFE    		cp	0xfe
  15:   48+10	F00C  C20081  		jp	nz,$8100
  16:   58+14	F00F  DD2104F1		ld	ix,flashtable+2	;first image
  17:     -	F013          	flashy:	
  18:   72+19	F013  DD6E00  		ld	l,(ix)		;start address
  19:   91+19	F016  DD6601  		ld	h,(ix+1)
  20:					;; check for zero = end
  21:  110+4	F019  7C      		ld	a,h
  22:  114+4	F01A  B5      		or	l
  23:  118+7+5	F01B  2836    		jr	z,flash_done
  24:  125+19	F01D  DD5E02  		ld	e,(ix+2)	;target address
  25:  144+19	F020  DD5603  		ld	d,(ix+3)
  26:  163+19	F023  DD4E04  		ld	c,(ix+4)	;count
  27:  182+19	F026  DD4605  		ld	b,(ix+5)
  28:  201+16+5	F029  EDB0    		ldir			;move it
  29:				
  30:  217+10	F02B  010800  		ld	bc,fimgsiz
  31:  227+15	F02E  DD09    		add	ix,bc
  32:				
  33:  242+4	F030  00      		nop
  34:  246+4	F031  00      		nop
  35:  250+4	F032  00      		nop
  36:					
  37:  254+19	F033  DD6E00  		ld	l,(ix)		;start address
  38:  273+19	F036  DD6601  		ld	h,(ix+1)
  39:					;; check for zero = end
  40:  292+4	F039  7C      		ld	a,h
  41:  296+4	F03A  B5      		or	l
  42:  300+7+5	F03B  2816    		jr	z,flash_done
  43:  307+19	F03D  DD5E02  		ld	e,(ix+2)	;target address
  44:  326+19	F040  DD5603  		ld	d,(ix+3)
  45:  345+19	F043  DD4E04  		ld	c,(ix+4)	;count
  46:  364+19	F046  DD4605  		ld	b,(ix+5)
  47:  383+16+5	F049  EDB0    		ldir			;move it
  48:				
  49:  399+10	F04B  010800  		ld	bc,fimgsiz
  50:  409+15	F04E  DD09    		add	ix,bc
  51:				
  52:  424+4	F050  00      		nop
  53:  428+4	F051  00      		nop
  54:  432+4	F052  00      		nop
  55:				
  56:				
  57:				;	jr	flashy		
  58:				
  59:     -	F053          	flash_done:	
  60:  436+16	F053  2A00F1  		ld	hl,(flashentry)	;start address
  61:				
  62:  452+10	F056  C30081  		jp	8100h		;goto UMON
  63:					
  64:					
  65:     -	F100          		org	$f100
  66:				
  67:				;;;
  68:				;;; table of flash images
  69:				;;; 
  70:     -	F100          	flashentry:
  71:				;	dw	0x9000		;entry point
  72:     -	F100  0081    		dw	0x8100		;entry point (umon for now)
  73:				
  74:     -	0008          	fimgsiz: equ	8		;size of one entry in bytes
  75:					
  76:     -	F102          	flashtable:	
  77:     -	F102  FECA    		dw	0xcafe		;magic number marks start of table
  78:				;;; first flash image (calculator)
  79:     -	F104  0010    		dw	0x1000		;start address in ROM
  80:     -	F106  0090    		dw	0x9000		;RAM target address
  81:     -	F108  0040    		dw	0x4000		;size in bytes (plenty big, now 0x2e00 or so)
  82:     -	F10A  0090    		dw	0x9000		;entry point (ignored, see flashentry)
  83:				
  84:				;;; second flash image (umon)
  85:     -	F10C  0050    		dw	0x5000		;above the first image
  86:     -	F10E  0081    		dw	0x8100		;RAM target address
  87:     -	F110  000F    		dw	0x0f00		;size in bytes
  88:     -	F112  0081    		dw	0x8100		;entry point (ignored, see flashentry)
  89:				
  90:     -	F114  00000000		dw	0,0,0,0		;table ends with zeroes
	              00000000
  91:					
  92:     -	F11C          		end



Statistics:

     4	passes
     0	jr promotions
     5	symbols
   117	bytes



Symbol Table:

fimgsiz        =   8     
flash_done      f053     
flashentry      f100     
flashtable      f102     
flashy          f013     
